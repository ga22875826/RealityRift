<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
	crossorigin="anonymous">
<link rel="short icon" href="img/images/jigsaw-icon.png">
<link rel="stylesheet" th:href="@{/css/maincss.css}">
<link rel="stylesheet" th:href="@{/css/registcss1.css}">
<script src="https://kit.fontawesome.com/68f8681dba.js"
	crossorigin="anonymous"></script>
<style>
.hid {
	display: none;
}

.flex {
	display: flex
}

.remark {
	font-size: 12px;
	font-style: italic;
	color: gray;
}

.main-content {
	margin-top: 10em;
}
</style>
<title>會員註冊</title>
</head>



<body>
	<!-- 導覽列 -->
	<div th:replace="~{layout/main_navbar}"></div>
	<!-- 註冊表單 -->
	<main class="colorwhite main-content">
		<section>
			<h1>會員註冊</h1>
			<div class="form">
				<form class="needs-validation" id="regist" method="post"
					th:action="@{/register}" enctype="multipart/form-data" novalidate>
					<div class="remark">*欄位為必填</div>
					<div class="remark">符號僅能使用._-</div>
					<div class="row">
						<div class="col-6">
							<div class="form-floating mb-3">
								<input type="email" class="form-control" id="email"
									placeholder="email" name="email" required> <label
									for="email" class="form-label">*E-mail</label>
								<div id="validationServerEmailFeedback"
									class="invalid-feedback">此E-mail已註冊過</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-6">
							<div class="form-floating mb-3">
								<input type="password" class="form-control" id="password"
									placeholder="password" name="password" required> <label
									for="password" class="form-label">*密碼(6~15碼)</label>
							</div>
						</div>
						<div class="col-6">
							<div class="form-floating mb-3">
								<input type="password" class="form-control" id="password2"
									placeholder="password2" name="password2" required> <label
									for="password2" class="form-label">*確認密碼</label>
								<div id="validationServerPasswordFeedback"
									class="invalid-feedback">兩次輸入的密碼不一致</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-6">
							<div class="form-floating mb-3">
								<input type="text" class="form-control" id="name"
									placeholder="name" name="memname" required> <label
									for="name" class="form-label">*姓名</label>
								<div id="validationServerMemnameFeedback"
									class="invalid-feedback">姓名不能為空</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-6">
							<div class="form-floating mb-3">
								<input type="text" class="form-control" id="id" placeholder="id"
									name="memid" required> <label for="id" class="form-label">*身分證字號</label>
								<div id="validationServerMemidFeedback"
									class="invalid-feedback">此身分證已註冊過</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-6">
							<label for="birthdate" class="form-label">*生日</label> <input
								type="date" class="form-control" id="birthdate" min="1900-01-01"
								value="1990-01-01"  name="birthdate" required>
						</div>
					</div>
					<br>
					<div class="row">
						<div class="col-12">
							<div class="form-floating mb-3">
								<input type="text" class="form-control" id="phone"
									placeholder="phone" name="phone"> <label for="phone"
									class="form-label">聯絡電話</label>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<div class="form-floating mb-3">
								<input type="text" class="form-control" id="address"
									placeholder="address" name="memaddress"> <label
									for="address" class="form-label">地址</label>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<label for="img" class="form-label">上傳頭像</label><br> <input
								accept="image/*" type='file' id="img" name="memimg" />
						</div>
						<div class="col">
							<img class="imgUpload" id="filePic" src="#" alt="圖片預覽" style="display: none;"/>
						</div>
					</div>
					<br>
					<div class="row">
						<div class="col-12">
							<label for="privacyPolicy">隱私權條款</label>
							<textarea class="form-control" name="" id="privacyPolicy"
								cols="30" rows="10" readonly>
                                非常歡迎您光臨「Reality Rift 實境裂谷」（以下簡稱本網站），為了讓您能夠安心的使用本網站的各項服務與資訊，特此向您說明本網站的隱私權保護政策，以保障您的權益，請您詳閱下列內容：
                                一、隱私權保護政策的適用範圍
                                隱私權保護政策內容，包括本網站如何處理在您使用網站服務時收集到的個人識別資料。隱私權保護政策不適用於本網站以外的相關連結網站，也不適用於非本網站所委託或參與管理的人員。
                                二、個人資料的蒐集、處理及利用方式
                                • 當您造訪本網站或使用本網站所提供之功能服務時，我們將視該服務功能性質，請您提供必要的個人資料，並在該特定目的範圍內處理及利用您的個人資料；非經您書面同意，本網站不會將個人資料用於其他用途。
                                • 本網站在您使用服務信箱、問卷調查等互動性功能時，會保留您所提供的姓名、電子郵件地址、聯絡方式及使用時間等。
                                • 於一般瀏覽時，伺服器會自行記錄相關行徑，包括您使用連線設備的 IP 位址、使用時間、使用的瀏覽器、瀏覽及點選資料記錄等，做為我們增進網站服務的參考依據，此記錄為內部應用，決不對外公佈。
                                • 為提供精確的服務，我們會將收集的問卷調查內容進行統計與分析，分析結果之統計數據或說明文字呈現，除供內部研究外，我們會視需要公佈統計數據及說明文字，但不涉及特定個人之資料。
                                • 您可以隨時向我們提出請求，以更正或刪除本網站所蒐集您錯誤或不完整的個人資料。
                                三、資料之保護
                                • 本網站主機均設有防火牆、防毒系統等相關的各項資訊安全設備及必要的安全防護措施，加以保護網站及您的個人資料採用嚴格的保護措施，只由經過授權的人員才能接觸您的個人資料，相關處理人員皆簽有保密合約，如有違反保密義務者，將會受到相關的法律處分。
                                • 如因業務需要有必要委託其他單位提供服務時，本網站亦會嚴格要求其遵守保密義務，並且採取必要檢查程序以確定其將確實遵守。
                                四、網站對外的相關連結
                                本網站的網頁提供其他網站的網路連結，您也可經由本網站所提供的連結，點選進入其他網站。但該連結網站不適用本網站的隱私權保護政策，您必須參考該連結網站中的隱私權保護政策。
                                五、與第三人共用個人資料之政策
                                本網站絕不會提供、交換、出租或出售任何您的個人資料給其他個人、團體、私人企業或公務機關，但有法律依據或合約義務者，不在此限。
                                前項但書之情形包括不限於：
                                • 經由您書面同意。
                                • 法律明文規定。
                                • 為免除您生命、身體、自由或財產上之危險。
                                • 與公務機關或學術研究機構合作，基於公共利益為統計或學術研究而有必要，且資料經過提供者處理或蒐集者依其揭露方式無從識別特定之當事人。
                                • 當您在網站的行為，違反服務條款或可能損害或妨礙網站與其他使用者權益或導致任何人遭受損害時，經網站管理單位研析揭露您的個人資料是為了辨識、聯絡或採取法律行動所必要者。
                                • 有利於您的權益。
                                • 本網站委託廠商協助蒐集、處理或利用您的個人資料時，將對委外廠商或個人善盡監督管理之責。
                                六、Cookie 之使用
                                為了提供您最佳的服務，本網站會在您的電腦中放置並取用我們的 Cookie，若您不願接受 Cookie 的寫入，您可在您使用的瀏覽器功能項中設定隱私權等級為高，即可拒絕 Cookie 的寫入，但可能會導致網站某些功能無法正常執行 。
                                七、隱私權保護政策之修正
                                本網站隱私權保護政策將因應需求隨時進行修正，修正後的條款將刊登於網站上。</textarea>
						</div>
					</div>
					<br>
					<div class="form-check">
						<input class="form-check-input" type="checkbox" id="checkbox"
							disabled> <label class="form-check-label" for="gridCheck">
							已閱讀並同意隱私權條款 </label>
					</div>
					<br>
					<div class="col-12 confirmDiv">
						<button type="button" form="regist"
							class="btn btn-primary confirmWarning" id="confirm" disabled>註冊</button>
						<button type="button" class="btn btn-secondary" id="oneClick">一鍵輸入</button>
					</div>
				</form>
			</div>
		</section>
	</main>
	<!-- btn-to-top -->
	<a href="#" class="btn btn-to-top"> <svg
			xmlns="http://www.w3.org/2000/svg" width="16" height="16"
			fill="currentColor" class="bi bi-arrow-bar-up" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
				d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5zm-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5z" />
            </svg>
	</a>

	<!-- footer -->
	<div th:replace="~{layout/main_footer}"></div>

	<script th:src="@{/js/jquery-3.6.4.js}"></script>
	<script>
            $(function () {
				
				$('#birthdate').attr('max',new Date().toLocaleDateString('en-CA'));
				
                img.onchange = function () {
                    const [file] = img.files
                    if (file) {
                        filePic.src = URL.createObjectURL(file);
                        document.querySelector("#filePic").style.display = "inline";
                    }
                }
                
                
                
                //必填欄位資料驗證
                let emailOK=false,emailWarning='E-mail不能為空',
                passwordOK=false,passwordWarning='密碼不能為空',
                nameOK=false,nameWarning='姓名不能為空',
                idOK=false,idWarning='身分證字號不能為空',
                password2OK=false,password2Warning='';

                $('#email').blur(function () {
                	//email重複驗證
                	$.ajax({
                        type: 'GET',
                        url: '/rr/api/emailrepeatedcheck',
                        data:{
							email:$('#email').val()
						},
                        success: function (repeated) {
                            if(repeated){
                                    $('#email').addClass('is-invalid');
                                    emailCheck();
                            }else{
                                $('#email').removeClass('is-invalid');
                                emailCheck();
                            }
                        }
                    })
                	
                    emailCheck();
                	
                })
                 $('#password').blur(function () {
                	 passwordCheck()
                 })
                 $('#password2').blur(function () {
                	 password2Check()
                 })
                 $('#name').blur(function () {
                	 nameCheck()
                 })
                 
                 $('#id').blur(function () {
                	//身分證重複驗證
                	 $.ajax({
                         type: 'GET',
                         url: '/rr/api/memidrepeatedcheck',
                         data:{
 							memid:$('#id').val()
 						},
                         success: function (repeated) {
                             if(repeated){
                                     $('#id').addClass('is-invalid');
                                     idCheck();
                             }else{
                                 $('#id').removeClass('is-invalid');
                                 idCheck();
                             }
                         }
                     })
                	 idCheck();
                 })
                 function checkInfo(){
                	if(emailOK&&passwordOK&&password2OK&&nameOK&&idOK){
                 		$('#confirm').removeClass('confirmWarning').addClass('confirmSubmit');
                 	}else{
                 		$('#confirm').addClass('confirmWarning').removeClass('confirmSubmit');
                 	}
                }
                
                function emailCheck(){
                	if($('#email').val()==''){
                		emailOK=false;
                		emailWarning='E-mail不能為空';
                	}else if($('#email').hasClass('is-invalid')){
                		emailOK=false;
                		emailWarning='此E-mail已使用';
                	}else if($('#email').val().match(/^[A-Za-z0-9._-]+@[a-z0-9.-]+\.[a-z0-9]{2,4}/)){
                		emailOK=true;
                		emailWarning='';
                	}else{
                		emailOK=false;
                		emailWarning='E-mail字元或格式有誤';
                	}
                	checkInfo();
                }
                function passwordCheck(){
                	 if($('#password').val()==''){
                  		passwordOK=false;
                  		passwordWarning='密碼不能為空';
                  	}else if($('#password').val().match(/^[A-Za-z0-9._-]{6,15}$/)){
                  		passwordOK=true;
                  		passwordWarning='';
                  	}else{
                  		passwordOK=false;
                  		passwordWarning='密碼字元或格式有誤';
                  	}
                 	 if($('#password2').val()==$('#password').val()){
                   		password2OK=true;
                   		password2Warning='';
                   	}else{
                   		password2OK=false;
                   		password2Warning='兩次輸入的密碼不一致';
                   	}
                 	 checkInfo();
                }
                function password2Check(){
                	if($('#password2').val()==$('#password').val()){
                 		password2OK=true;
                 		password2Warning='';
                 	}else{
                 		password2OK=false;
                 		password2Warning='兩次輸入的密碼不一致';
                 	}
                	 checkInfo();
                }
                function nameCheck(){
                	if($('#name').val()==""){
               		 nameOK=false;
               		 nameWarning='姓名不能為空';
                	}else{
                		nameOK=true;
                		nameWarning='';
                	}
               	 checkInfo();
                }
                function idCheck(){
                	if($('#id').val()==''){
                 		idOK=false;
                 		idWarning='身分證字號不能為空';
                 	}else if($('#id').hasClass('is-invalid')){
                		idOK=false;
                		idWarning='此身分證字號已使用';
                	}else if(verifyId($('#id').val())){
                 		idOK=true;
                 		idWarning='';
                 	}else{
                 		idOK=false;
                 		idWarning='身分證字號字元或格式有誤';
                 	}
                	 checkInfo();
                }
                
                
                
                //註冊按鈕
                $('.confirmDiv').on('click','.confirmWarning',function(){
                	let warningHtml="";
                	if(emailWarning!=""){warningHtml+=(emailWarning+"<br>")};
                	if(passwordWarning!=""){warningHtml+=(passwordWarning+"<br>")};
                	if(password2Warning!=""){warningHtml+=(password2Warning+"<br>")};
                	if(nameWarning!=""){warningHtml+=(nameWarning+"<br>")};
                	if(idWarning!=""){warningHtml+=idWarning};
                	Swal.fire({
                		  title: '欄位資料發生錯誤',
                		  html: "<div style=color:red>"+warningHtml+"</div>",
                		  icon: 'error'
                		})
                })
                $('.confirmDiv').on('click','.confirmSubmit',function(){
                	Swal.fire({
                		  title: '註冊成功',
                		  icon: 'success',
                		  text:"請至註冊信箱收信並點擊連結啟用帳戶",
                		  confirmButtonColor: '#3085d6',
                		  confirmButtonText: 'OK'
                		}).then((result) => {
                		  if (result.isConfirmed) {
                			  $('#regist').submit();
                		  }
                		})
                })
                
                
                $('#password').blur(function () {
                	if($('#password').val()!=$('#password2').val()){
                		$('#password2').addClass('is-invalid');
                	}else{
                		$('#password2').removeClass('is-invalid');
                	}
                })
                $('#password2').blur(function () {
                	if($('#password').val()!=$('#password2').val()){
                		$('#password2').addClass('is-invalid');
                	}else{
                		$('#password2').removeClass('is-invalid');
                	}
                })
                //身分證格式驗證
                function verifyId(id) {
                    id = id.trim();
                    
                    verification = id.match("^[A-Z][1289]\\d{8}$")
                	if(!verification){
                		return false
                	}

                    let conver = "ABCDEFGHJKLMNPQRSTUVXYWZIO";
                    let weights = [1, 9, 8, 7, 6, 5, 4, 3, 2, 1, 1];

                    id = String(conver.indexOf(id[0]) + 10) + id.slice(1);

                    checkSum = 0
                    for (let i = 0; i < id.length; i++) {
                        c = parseInt(id[i]);
                        w = weights[i];
                        checkSum += c * w;
                    }
                	
                    return (checkSum % 10 == 0)
                }
              //一鍵輸入
                $('#oneClick').click(function(){
                	$('#email').val("ycyao1103@gmail.com");
                	$('#password').val("123456");
                	$('#password2').val("123456");
                	$('#name').val("姚奕辰");
                	$('#id').val("F109816831");
                	$('#phone').val("0912-345678");
                	$('#address').val("桃園市中壢區新生路二段421號");
                	emailOK=true;
                	passwordOK=true;
                	password2OK=true;
                	nameOK=true;
                	idOK=true;
                	emailWarning='';
                    passwordWarning='';
                    nameWarning='';
                    idWarning='';
                	checkInfo();
                })
                
                //隱私權條款捲動到底開啟checkbox
                $('#privacyPolicy').scroll(function(){
                	if($('#privacyPolicy').prop('scrollHeight')-$('#privacyPolicy').prop('scrollTop')<=$('#privacyPolicy').prop('clientHeight')){
                		$('#checkbox').prop('disabled',false);
                	}
                })
                //checkbox勾選後才可submit
                $("#checkbox").on("change", function () {
                    $("#confirm").prop("disabled", !$(this).prop("checked"));
                })


            })

        </script>

	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
		integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
		integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
		crossorigin="anonymous"></script>
</body>

</html>