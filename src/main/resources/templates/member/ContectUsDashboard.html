<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="light">

<head>
  <meta charset="UTF-8">
  <title>表單管理-未回覆</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">
  <link rel="stylesheet" th:href="@{/css/maincss.css}">
  <link rel="stylesheet" th:href="@{/css/myDataTable.css}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />	

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
    crossorigin="anonymous">
  <style>
	
	textarea{
		resize:none;
		height: 150px;
	}
	
	.already-read{
		background-color: lightgray;
		font-style: italic;
	}
	
	
	.contectUs-row{
		cursor:pointer;
	}
	  
	  
	  
    .imgUpload {
      max-width: 200px;
      max-height: 200px;
    }

    input {
      text-overflow: ellipsis;
    }

    .page-button {
      position: absolute;
      right: 2%;
      bottom: 4%;
    }

    .contentColor {
      color: var(--app-content-main-color);
    }

    .memstatus {
      width: 8em;
      margin-left: 3em;
    }

    .btn:hover {
      scale: 1.05;
    }
    
    .status{
		cursor:pointer;
	}
	
	.displayNone{
		visibility: hidden;
	}


  </style>
</head>

<body>
  <div class="app-container">
	<div th:replace="~{layout/dashboard_sidebar}"></div>
    <div class="app-content" style="min-height:100vh">
      <div class="app-content-header">
        <h1 class="app-content-headerText">表單管理(未回覆)</h1>
        <!--  <button class="mode-switch" title="Switch Theme">
          <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
            <defs></defs>
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
          </svg>
        </button>-->
      </div>
      <table class="display products-area-wrapper tableView" id="myTable">
        <thead>
          <tr class="products-header ">
            <th class="product-cell category">E-mail
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
            <th class="product-cell status-cell">姓名
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
            <th class="product-cell sales">電話
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
            <th class="product-cell stock">主題
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
            <th class="product-cell stock">主旨
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
            <th class="product-cell price">送出時間
            <button class="sort-button" id="idsort">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="currentColor"
          d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" />
      </svg>
      </button></th>
          </tr>
        </thead>
        <tbody class="overflowAuto">
			<th:block th:each="contectUs,iterStat : ${contectUsList}">
				<!--未讀-->
                <tr th:if="${contectUs.status==0}" th:data-id="${contectUs.contectid}" class="contectUs-row products-row " data-bs-toggle="modal" data-bs-target="#modal">
				  <input class="contectid" type="hidden" th:value="${contectUs.contectid}"/>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.email}]]
                  </td>
                  <td class="product-cell status-cell text-truncate" >
                    [[${contectUs.name}]]
                  </td>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.phone}]]
                  </td>
                  <td th:if="${contectUs.theme}==1" class="product-cell category d-inline-block text-truncate">會員帳號相關</td>
                  <td th:if="${contectUs.theme}==2" class="product-cell category d-inline-block text-truncate">網站使用相關</td>
                  <td th:if="${contectUs.theme}==3" class="product-cell category d-inline-block text-truncate">遊戲預約相關</td>
                  <td th:if="${contectUs.theme}==4" class="product-cell category d-inline-block text-truncate">論壇討論相關</td>
                  <td th:if="${contectUs.theme}==5" class="product-cell category d-inline-block text-truncate">周邊商城相關</td>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.topic}]]
                  </td>
                  <td class="product-cell category d-inline-block text-truncate contect-time">
                    [[${contectUs.contecttime}]]
                  </td>
                </tr>
                <!--已讀-->
                <tr th:if="${contectUs.status==1}" th:data-id="${contectUs.contectid}" class="contectUs-row products-row already-read" data-bs-toggle="modal" data-bs-target="#modal">
				  <input class="contectid" type="hidden" th:value="${contectUs.contectid}"/>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.email}]]
                  </td>
                  <td class="product-cell status-cell text-truncate" >
                    [[${contectUs.name}]]
                  </td>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.phone}]]
                  </td>
                  <td th:if="${contectUs.theme}==1" class="product-cell category d-inline-block text-truncate">會員帳號相關</td>
                  <td th:if="${contectUs.theme}==2" class="product-cell category d-inline-block text-truncate">網站使用相關</td>
                  <td th:if="${contectUs.theme}==3" class="product-cell category d-inline-block text-truncate">遊戲預約相關</td>
                  <td th:if="${contectUs.theme}==4" class="product-cell category d-inline-block text-truncate">論壇討論相關</td>
                  <td th:if="${contectUs.theme}==5" class="product-cell category d-inline-block text-truncate">周邊商城相關</td>
                  <td class="product-cell category d-inline-block text-truncate">
                    [[${contectUs.topic}]]
                  </td>
                  <td class="product-cell category d-inline-block text-truncate contect-time">
                    [[${contectUs.contecttime}]]
                  </td>
                </tr>
             </th:block>
        </tbody>
      </table>
      
        <!--檢視 Modal -->
        <div class="modal fade" id="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">表單詳細內容</span>
                </h5>
                <button type="button" id="btn-close" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row">
					<div class="col-6">Email:<input class="form-control" id="thisEmail" disabled></input></div>
					<div class="col-6">姓名:<input class="form-control" id="thisName" disabled></input></div>
                </div>
                <div class="row">
					<div class="col-6">電話:<input class="form-control" id="thisPhone" disabled></input></div>
					<div class="col-6">主題:<input class="form-control" id="thisTheme" disabled></input></div>

                </div>
                <div class="row">
					<div class="col-12">主旨:<input class="form-control" id="thisTopic" disabled></input></div>
                </div>
                <div class="row">
					<div class="col-12">表單內容:<textarea class="form-control" id="thisContent" disabled></textarea></div>
                </div>
                <div class="collapse" id="collapseExample">
					  <div class="row">
						  <div class="col-12">回覆內容:<textarea class="form-control" id="responseContent"></textarea></div>
					  </div><br>
					  <div class="row">
						  <div class="offset-md-8 col-2"><button id="one-btn" class="btn btn-sm btn-success">一鍵</button></div>
						  <div class="col-2"><button id="response-btn" class="btn btn-sm btn-outline-success">送出</button></div>
					  </div>
						  
				</div>
              </div>
              <div class="modal-footer">
                <button id="response-expand-btn" type="button" class="btn btn-outline-primary" data-bs-toggle="collapse" href="#collapseExample">回覆</button>
              </div>
            </div>
          </div>
        </div>
        
        
          <br>
    </div>
  </div>

  <script th:src="@{/js/jquery-3.6.4.js}"></script>
  <script th:src="@{/js/jquery.dataTables.js}"></script>
  
  <script th:inline="javascript">
	  
  			  let table = new DataTable('#myTable');  			  
              window.onload = function () {
              
                $(function () {
					
				  //一鍵輸入
				  $('#one-btn').click(function(){
					  $('#responseContent').val('不好意思，您的帳號為系統誤鎖，\n目前已成功為您解鎖，請再嘗試登入看看。')
				  })
					
					
				  let contectid = 0;
					//時間去除T
				  $('.contect-time').each(function(){
					  $(this).text($(this).text().replace("T"," "));
				  })
				  
				  $('#contectForm-ul').attr('style','display:block');
                  //切換sidebar active標籤
                  document.querySelector(".li-contectForm-notResponse").classList.add("active");


				  $('.contectUs-row').click(function(){
					  contectid= $(this).find('.contectid').val();
					  $(this).addClass('already-read');
					  $.ajax({
						  url:'/rr/api/updatestatusto1',
						  type:'PUT',
						  data:{contectid:contectid},
						  success:function(result){
							  $('#thisEmail').val(result.email);
							  $('#thisName').val(result.name);
							  $('#thisPhone').val(result.phone);
							  switch(result.theme){
								  case 1:{
									  $('#thisTheme').val('會員帳號相關');
									  break;
								  }
								  case 2:{
									  $('#thisTheme').val('網站使用相關');
									  break;
								  }
								  case 3:{
									  $('#thisTheme').val('遊戲預約相關');
									  break;
								  }
								  case 4:{
									  $('#thisTheme').val('論壇討論相關');
									  break;
								  }
								  case 5:{
									  $('#thisTheme').val('周邊商城相關');
									  break;
								  }
							  }
							  
							  $('#thisTopic').val(result.topic);
							  $('#thisContent').val(result.content);
						  },
						  error:function(){
							  console.log('error');
						  }
					  })
				  })
					
					
				  $('#response-btn').click(function(){
					  Swal.fire({
						  title: '是否確定送出?',
						  icon: 'warning',
						  showCancelButton: true,
						  confirmButtonColor: '#3085d6',
						  cancelButtonColor: '#d33',
						  confirmButtonText: '是的',
						  cancelButtonText: '取消'
						}).then((result) => {
						  if (result.isConfirmed) {
							  $.ajax({
								  url:'/rr/api/contectresponse',
								  type:'PUT',
								  data:{
									  contectid:contectid,
									  responsecontent:$('#responseContent').val()
								  },
								  success:function(result){
									  console.log(result);
									  if(result){
										  Swal.fire(
										      '已成功回覆!',
										      '已將回覆信件寄至提問人信箱',
										      'success'
										    ).then((result) => {
											  if (result.isConfirmed) {
											    $('#btn-close').click();
											    $('#responseContent').val('');
											    $('#response-expand-btn').click();
											    $('tr[data-id="'+contectid+'"]').addClass('animate__animated animate__fadeOut');
											  }
											})
									  }else{
										  Swal.fire(
										      '發生錯誤!!',
										      '回覆信件失敗',
										      'error'
										    )
									  }
								  },
								  error:function(){
									  console.log('error');
								  }
							  })
						    
						  }
						})
				  })




            		})
	        }
              
              
  </script>
	
  <!-- partial -->
  <script th:src="@{/js/dashboard.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
    integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
    integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>

</html>