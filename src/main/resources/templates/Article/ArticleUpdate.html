<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>論壇管理</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel="stylesheet" th:href="@{/css/Article/dashboard.css}" type="text/css">
    <link rel="stylesheet" th:href="@{/css/Article/article_Dashboard.css}" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://www.w3schools.com/lib/w3.js"></script>


    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <!-- DataTable -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
    <!-- RWD Javascript -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <!-- RWD CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css">
    <!-- Datatable CSS -->
    <link rel="stylesheet" th:href="@{/css/Article/article_DataTable.css}" type="text/css">
    <!-- sweetalert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>


</head>


<body>
    <!-- partial:index.partial.html -->
    <div class="app-container">
        <div th:replace="~{layout/dashboard_sidebar}"></div>


        <div class="app-content">
            <div class="app-content-header">
                <h1 class="app-content-headerText">論壇管理 - 修改</h1>
                <button class="mode-switch" title="Switch Theme">
                    <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
                        <defs></defs>
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
                </button>
            </div>
            <div class="app-content-actions">
                <div class="app-content-actions-wrapper">
                    <div class="filter-button-wrapper">
                        <button class="action-button filter jsFilter"><span>Filter</span><svg
                                xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-filter">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
                            </svg></button>
                        <div class="filter-menu">
                            <label>Category</label>
                            <select>
                                <option>All Categories</option>
                                <option>Furniture</option>
                                <option>Decoration</option>
                                <option>Kitchen</option>
                                <option>Bathroom</option>
                            </select>
                            <label>Status</label>
                            <select>
                                <option>All Status</option>
                                <option>Active</option>
                                <option>Disabled</option>
                            </select>
                            <div class="filter-menu-buttons">
                                <button class="filter-button reset">
                                    Reset
                                </button>
                                <button class="filter-button apply">
                                    Apply
                                </button>
                            </div>
                        </div>
                    </div>
                    <button class="action-button list active" title="List View">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-list">
                            <line x1="8" y1="6" x2="21" y2="6" />
                            <line x1="8" y1="12" x2="21" y2="12" />
                            <line x1="8" y1="18" x2="21" y2="18" />
                            <line x1="3" y1="6" x2="3.01" y2="6" />
                            <line x1="3" y1="12" x2="3.01" y2="12" />
                            <line x1="3" y1="18" x2="3.01" y2="18" />
                        </svg>
                    </button>
                    <button class="action-button grid" title="Grid View">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-grid">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg>
                    </button>
                </div>
            </div>

            <div style="border: 1px double black; padding: 10px; margin: 10px; border-radius: 15px;">
                <div class="form">
                    <form th:action="@{/Article/UpdateArticle}" method="POST">
                        <input type="hidden" name="topicId" th:value="${topicId}">
                        <div class="row">
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="text" name="title" class="form-control" id="title" placeholder="title"
                                        th:value="${title}">
                                    <label for="title" class="form-label">文章標題</label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" style="height: 500px;" name="content" id="content"
                                        placeholder="content" th:text="${content}"></textarea>
                                    <label for="content" class="form-label">文章內容</label>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="col-12 btn-end">
                            <div class="d-flex justify-content-end">
                                <button th:id="'update-' + ${topicId}" type="submit" class="btn btn-primary">修改</button>
                                <button id="cancelButton" type="button" class="btn btn-secondary ml-2">取消</button>
                            </div>
                        </div>
                    </form>
                </div>


            </div>

        </div>
    </div>


    <script>
        const updateButtons = document.querySelectorAll('[id^="update-"]');
        updateButtons.forEach((button) => {
            button.addEventListener('click', function (event) {
                event.preventDefault();

                const buttonId = button.id;
                const topicId = buttonId.split('-')[1];

                let updateTitle = $('#title').val();
                let updateContent = $('#content').val();
                // console.log(updateTitle)
                // console.log(updateContent)
                Swal.fire({
                    title: '確認',
                    text: '是否要修改此資料？',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: '確定',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.isConfirmed) {
                        updateContentByTopicId(topicId, updateTitle, updateContent);

                    }
                });
            });
        });

        function updateContentByTopicId(topicId, updateTitle, updateContent) {
            $.ajax({
                url: 'http://localhost:8080/rr/Article/UpdateArticle',
                type: 'PUT',
                data: {
                    topicId: topicId,
                    title: updateTitle,
                    content: updateContent


                },
                success: function (response) {
                    Swal.fire({
                        title: '成功',
                        text: '修改成功',
                        icon: 'success'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = 'http://localhost:8080/rr/db/Article/ManagePage';
                        }
                    });
                },
                error: function (xhr, status, error) {
                    Swal.fire({
                        title: '錯誤',
                        text: '修改失敗',
                        icon: 'error'
                    });
                }
            });
        }
    </script>

    <script>
        const cancelButton = document.getElementById('cancelButton');
        cancelButton.addEventListener('click', function () {
            window.location.href = 'http://localhost:8080/rr/db/Article/ManagePage';
        });
    </script>

    <!-- partial -->
    <script th:src="@{js/dashboard.js}" type="text/js"></script>
    <script>
        w3.includeHTML();
    </script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
        integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.jss"
        integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
        crossorigin="anonymous"></script> -->
</body>

</html>